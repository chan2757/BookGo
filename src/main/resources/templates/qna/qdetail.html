<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상세보기</title>
    <link rel="stylesheet" href="/css/style1.css">
</head>
<body>
    <header>
        <h1>Bookgo Q&A</h1>
    </header>

    <div class="container">
        <div class="detail-container">
            <div class="detail-header">
                <h2 th:text="${qna.title}">제목</h2>
                <p>작성자: <span th:text="${qna.writer}"></span></p>
                <p>작성일: <span th:text="${#temporals.format(qna.writeDate, 'yyyy년 MM월 dd일 HH:mm:ss')}"></span></p>
            </div>
            <div class="detail-content">
                <p th:text="${qna.content}"></p>
                <div th:if="${qna.filename}">
                    <p>파일: 
					    <a th:href="@{/files/{filename}(filename=${qna.filename})}" 
					       th:text="${qna.filename}" 
					       href="#" 
					       download>Download</a>
					</p>
                </div>
            </div>
            <div class="detail-footer">
                <a class="button" th:href="@{/qna/modify/{id}(id=${qna.id})}">수정하기</a>
				<a class="button" th:href="@{/qna/delete/{id}(id=${qna.id})}" onclick="return confirm('정말 삭제하시겠습니까?');">삭제하기</a>
                <a class="button" href="/qna/">목록으로 돌아가기</a>
            </div>
        </div>

		<!-- 답글 폼 -->
			<div class="reply-form">
			    <h3>답글 달기</h3>
			    <form action="/qna/reply/add" method="post">
			        <input type="hidden" name="qnaId" th:value="${qna.id}" />
			        <div class="form-group">
			            <label for="writer">작성자:</label>
			            <input type="text" id="writer" name="writer" class="input-text">
			        </div>
			        <div class="form-group">
			            <label for="content">내용:</label>
			            <textarea id="content" name="content" class="input-textarea"></textarea>
			        </div>
			        <div class="actions">
			            <button type="submit" class="button">답글 작성</button>
			        </div>
			    </form>
			</div>

        <!-- 답글 리스트 -->
			<div class="reply-list">
			    <h3>답글 목록</h3>
			    <ul>
			        <li th:each="reply : ${replies}">
			            <p th:text="${reply.content}"></p>
			            <p>작성자: <span th:text="${reply.writer}"></span></p>
			            <p>작성일: <span th:text="${#temporals.format(reply.writeDate, 'yyyy년 MM월 dd일 HH:mm:ss')}"></span></p>
			            
						<!-- 댓글 수정 폼 (처음엔 숨겨져 있음) -->
						<div id="editForm" th:id="'editForm' + ${reply.id}" style="display: none;">
						    <form th:action="@{/qna/reply/modify/{replyId}(replyId=${reply.id})}" method="post">
						        <input type="hidden" name="qnaId" th:value="${qna.id}" />
						        <textarea name="content" class="input-textarea" th:text="${reply.content}"></textarea>
						        <button type="submit">저장</button>
						        <button type="button" th:onclick="'cancelEdit(' + ${reply.id} + ')'">취소</button>
						    </form>
						</div>
						
						<!-- 수정 버튼 (누르면 수정 폼이 보임) -->
						<button type="button" th:onclick="'showEditForm(' + ${reply.id} + ')'">수정</button>
						
						<!-- 댓글 삭제 버튼 -->
						<form th:action="@{/qna/reply/delete/{replyId}(replyId=${reply.id})}" method="post">
						    <button type="submit">삭제</button>
						</form>
			        </li>
			    </ul>
			</div>
    </div>

    <footer>
        <p>&copy; 2024 Bookgo Q&A Board</p>
    </footer>
		<script>
		    function showEditForm(replyId) {
		        // 해당 ID의 수정 폼을 보여줌
		        document.getElementById('editForm' + replyId).style.display = 'block';
		    }
		
		    function cancelEdit(replyId) {
		        // 해당 ID의 수정 폼을 다시 숨김
		        document.getElementById('editForm' + replyId).style.display = 'none';
		    }
		</script>
</body>
</html>